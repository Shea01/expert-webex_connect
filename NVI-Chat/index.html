<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebEx Connect Chat Widget Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-bottom: 10px;
        }
        .status {
            display: inline-block;
            padding: 5px 10px;
            background: #10b981;
            color: white;
            border-radius: 5px;
            font-size: 14px;
            margin-left: 10px;
        }
        .info-box {
            background: #f3f4f6;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }
        .test-section {
            margin: 30px 0;
            padding: 20px;
            border: 2px dashed #e5e7eb;
            border-radius: 8px;
        }
        .test-section h2 {
            color: #667eea;
            margin-top: 0;
        }
        .checklist {
            list-style: none;
            padding-left: 0;
        }
        .checklist li {
            padding: 5px 0;
            position: relative;
            padding-left: 25px;
        }
        .checklist li::before {
            content: '‚òê';
            position: absolute;
            left: 0;
        }
        .checklist li.checked::before {
            content: '‚úì';
            color: #10b981;
        }
        footer {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #e5e7eb;
            text-align: center;
            color: #6b7280;
        }
        .widget-status {
            padding: 10px;
            background-color: #fef3c7;
            border: 1px solid #fbbf24;
            border-radius: 5px;
            margin: 20px 0;
        }
        .widget-status.active {
            background-color: #d1fae5;
            border-color: #10b981;
        }
        
        /* ============================================
           CHAT WIDGET REPOSITIONING CSS
           Added to move widget higher to avoid favorites button
           Position: Line 97-107 in the style section
           ============================================ */
        
        /* Move chat widget higher to avoid favorites button overlap */
        .icw-widget,
        #divicw iframe,
        iframe[src*="imi.chat"],
        iframe[title*="chat"],
        iframe[title*="Chat"] {
            bottom: 80px !important;  /* Moved up from default 20px to 80px */
            right: 20px !important;   /* Keeping same horizontal position */
        }
        
        /* Also adjust the TLS alert frame if it appears */
        #tls_al_frm {
            bottom: 72px !important;  /* Adjusted to align with chat widget */
        }
        
        /* Mobile responsive adjustment - prevent full screen takeover */
        @media only screen and (max-width: 768px) {
            .icw-widget,
            .icw-chatview,
            iframe[src*="imi.chat"] {
                max-height: 70vh !important;  /* Only take 70% of viewport height */
                max-width: 90vw !important;   /* Only take 90% of viewport width */
                bottom: 60px !important;      /* Slightly lower on mobile */
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>WebEx Connect Chat Widget Test Environment <span class="status">LIVE</span></h1>
        
        <div class="info-box">
            <strong>üöÄ Deployment Status:</strong> Successfully deployed on Render<br>
            <strong>üìç Domain:</strong> https://expert-webex-connect-1.onrender.com<br>
            <strong>üîÑ Last Updated:</strong> <span id="update-time"></span>
        </div>

        <div class="widget-status" id="widget-status">
            <strong>üí¨ Chat Widget Status:</strong> <span id="widget-state">Initializing...</span>
        </div>

        <div class="test-section">
            <h2>üì± Chat Widget Integration</h2>
            <p>The WebEx Connect/Engage chat widget should appear in the bottom-right corner of this page.</p>
            <p>If you don't see the chat widget:</p>
            <ol>
                <li>Check the browser console for errors (F12)</li>
                <li>Ensure your domain is whitelisted in WebEx Connect</li>
                <li>Verify the widget binding ID is correct</li>
                <li>Clear your browser cache and refresh</li>
            </ol>
        </div>

        <div class="test-section">
            <h2>üß™ Testing Checklist</h2>
            <ul class="checklist">
                <li id="check-1">Chat widget loads correctly</li>
                <li id="check-2">Chat bubble appears on page</li>
                <li id="check-3">Chat window opens when clicked</li>
                <li id="check-4">Messages send and receive properly</li>
                <li id="check-5">Agent routing works as expected</li>
                <li id="check-6">Mobile responsive view works</li>
                <li id="check-7">Cookie consent works properly</li>
            </ul>
        </div>

        <div class="test-section">
            <h2>üîß Widget Configuration</h2>
            <p><strong>Binding ID:</strong> 9D737EF5-C907-49BC-9E80-8C72DB678FE7</p>
            <p><strong>Widget Color:</strong> #0F0F0F</p>
            <p><strong>Display Name:</strong> Display Name</p>
            <p><strong>Cookie Consent:</strong> Enabled</p>
            <p><strong>Position Adjustment:</strong> Raised 60px to avoid favorites button overlap</p>
        </div>

        <footer>
            <p>WebEx Connect Test Environment | Powered by Render + GitHub</p>
            <p style="font-size: 12px; color: #9ca3af;">Widget ID: divicw | Last deployment: <span id="deploy-time"></span></p>
        </footer>
    </div>

    <!-- WebEx Connect/Engage Chat Widget Script -->
    <div id="divicw" data-bind="9D737EF5-C907-49BC-9E80-8C72DB678FE7" data-org=""></div>
    
    <script>
        // Display timestamps
        document.getElementById('update-time').textContent = new Date().toLocaleString();
        document.getElementById('deploy-time').textContent = new Date().toLocaleString();
        
        // WebEx Cookie Consent Configuration
        var cookieConsentWidgetOptions = {
            "buttonType": "type1",
            "widgetColor": "#0F0F0F",
            "logoPath": "",
            "displayName": "Display Name",
            "greetingMessage": "",
            "bylineText": "Byline text, this is usually used to write a small description or company tagline max chat limit 100",
            "cookiePreferencesHeaderText": "Cookie Preferences",
            "privacyPolicyText": "Privacy Policy",
            "privacyPolicyUrl": "",
            "acceptButtonText": "Accept Cookies",
            "rejectButtonText": "Reject",
            "cookieConsentMessage": "We use cookies to help secure, provide, and improve our services. You agree to consent to cookies to continue using LiveChat. If you reject cookies, you'll no longer be able to use LiveChat for support or continue any interactions. You can manage cookie preferences at any time.",
            "rejectConfirmationMessage": "By not accepting cookies you won't be able to get support via this widget. You can change preferences at any time and consent to continue.",
            "rejectRevokeButtonText": "Cookie preferences",
            "continueAcceptingCookiesText": "Continue"
        };
        
        // WebEx Widget Initialization Script
        var i = {
            t: function(t) {
                var e = "https://media.imi.chat/widget/js/imichatinit.js";
                try {
                    var o = new XMLHttpRequest;
                    o.onreadystatechange = function() {
                        if (this.readyState == 4) {
                            var t = document.getElementById("divicw");
                            if (this.status == 0) {
                                i.o(t);
                                return
                            }
                            var e = document.createElement("script");
                            e.innerHTML = this.responseText;
                            t.parentNode.insertBefore(e, t.nextSibling);
                            
                            // Update widget status
                            document.getElementById('widget-state').textContent = 'Active - Ready for testing';
                            document.getElementById('widget-status').classList.add('active');
                        }
                    };
                    o.open("GET", e, true);
                    o.send()
                } catch (s) {
                    console.error("WebEx Widget Error:", s);
                    document.getElementById('widget-state').textContent = 'Error loading widget - Check console';
                }
            },
            o: function(t) {
                t.insertAdjacentHTML("afterend", '<iframe id="tls_al_frm" frameborder="0" style="overflow: hidden;height: 208px;width: 394px;position: fixed;display: block;right: 48px;bottom: 12px;z-index: 99999; display:none;"></iframe>');
                var e = document.getElementById("tls_al_frm");
                var o = e.contentWindow || (e.contentDocument.document || e.contentDocument);
                o.document.open();
                o.document.write('<!doctype html><html><head><meta charset="utf-8"><title>Untitled Document</title><style>body{font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;color: #99a0b0;font-size: 14px;}.popover__content{background-color: #fbfbfe; padding: 1.5rem; border-radius: 5px; width: 300px; box-shadow: 0 2px 5px 0 rgba(0, 0, 0, 0.26);position: relative;}.popover__message{font-weight: 600;color:#56627c;font-size: 16px;}.pull-left{float:left;}.clearfix{clear: both;}.hdr-txt{width: 218px; margin-top: 3px;}.para-txt a{text-decoration: none;color: #005cde;}.close-btn{position: absolute;right:15px;top:15px;}.close-btn a{text-decoration: none;font-weight: 400; color: #56627c; font-size: 16px;}</style></head><body><div class="popover__content"><div class="close-btn"><a href="#" onclick="closeTLSAlert();">X</a></div><div class="popover__message"><div class="pull-left hdr-txt">This browser version is not supported on LiveChat.</div></div><div class="clearfix"></div><p class="para-txt">Please update your browser to the latest version and re-open the website to access the widget. </p></div><script>function closeTLSAlert(){window.parent.postMessage({key: "close_tls_alert",value: "close_tls_alert",action: "close_tls_alert"}, "*");}<\/script></body></html>');
                o.document.close();
                e.style.display = "block";
                window.addEventListener("message", function(t) {
                    if (t.data.action == "close_tls_alert") {
                        i.s()
                    }
                })
            },
            s: function() {
                var t = document.getElementById("tls_al_frm");
                t.remove()
            }
        };
        
        // Initialize the widget
        i.t(function(t) {});
        
        // Optional: Add console logging for debugging
        console.log("WebEx Chat Widget Initialization Started");
        console.log("Widget Binding ID: 9D737EF5-C907-49BC-9E80-8C72DB678FE7");
        console.log("Widget Container ID: divicw");
    </script>
</body>
</html>
